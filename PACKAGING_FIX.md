# æ‰“åŒ…é—®é¢˜ä¿®å¤è¯´æ˜ ğŸ”§

æœ¬æ–‡æ¡£è¯´æ˜äº†ä¸¤ä¸ªé‡è¦é—®é¢˜çš„ä¿®å¤æ–¹æ¡ˆã€‚

---

## ğŸ› é—®é¢˜ 1: WiX ä¸‹è½½å¤±è´¥

### é—®é¢˜æè¿°
Windows æ‰“åŒ…æ—¶æŠ¥é”™ï¼š
```
failed to bundle project: `protocol: http response missing version`
```

### åŸå› åˆ†æ
Tauri é»˜è®¤åŒæ—¶ç”Ÿæˆ MSI å’Œ NSIS ä¸¤ç§å®‰è£…åŒ…ã€‚MSI éœ€è¦ä¸‹è½½ WiX å·¥å…·åŒ…ï¼Œä½†ç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´ä¸‹è½½å¤±è´¥ã€‚

### è§£å†³æ–¹æ¡ˆ

**ä¿®æ”¹ `src-tauri/tauri.conf.json`:**

```json
"bundle": {
    "active": true,
    "targets": ["nsis"],  // åªç”Ÿæˆ NSIS å®‰è£…åŒ…
    "icon": ["icons/icon.ico"]
}
```

**è¯´æ˜ï¼š**
- NSIS æ˜¯å¼€æºçš„ Windows å®‰è£…åŒ…ç”Ÿæˆå·¥å…·ï¼Œä¸éœ€è¦é¢å¤–ä¸‹è½½
- NSIS ç”Ÿæˆçš„å®‰è£…åŒ…æ›´å°ï¼Œå®‰è£…é€Ÿåº¦æ›´å¿«
- å¦‚æœç¡®å®éœ€è¦ MSIï¼Œå¯ä»¥ä½¿ç”¨ `"targets": ["msi"]` æˆ–æ‰‹åŠ¨ä¸‹è½½ WiX

---

## ğŸ› é—®é¢˜ 2: æ‰“åŒ…åæ‰¾ä¸åˆ° names-dataset.txt

### é—®é¢˜æè¿°
æ‰“åŒ…åçš„ exe æ–‡ä»¶æ‰§è¡Œé‚®ç®±ç”ŸæˆåŠŸèƒ½æŠ¥é”™ï¼š
```
è´¦å·ç”Ÿæˆå¤±è´¥: æ‰¾ä¸åˆ° names-dataset.txt æ–‡ä»¶ï¼Œ
å°è¯•äº†ä»¥ä¸‹è·¯å¾„: ["names-dataset.txt", "src-tauri/names-dataset.txt", "../names-dataset.txt"]
```

### åŸå› åˆ†æ
å¼€å‘æ—¶å¯ä»¥è¯»å–æ–‡ä»¶ç³»ç»Ÿä¸­çš„ `names-dataset.txt`ï¼Œä½†æ‰“åŒ…åï¼š
- æ–‡ä»¶è·¯å¾„ä¼šæ”¹å˜
- å¯èƒ½è¢«æ‰“åŒ…åˆ°ä¸åŒçš„ä½ç½®
- ç›¸å¯¹è·¯å¾„ä¸å†æœ‰æ•ˆ

### è§£å†³æ–¹æ¡ˆ âœ…

**é‡‡ç”¨ `include_str!` å®å°†æ–‡ä»¶å†…å®¹ç¼–è¯‘è¿›äºŒè¿›åˆ¶:**

ä¿®æ”¹ `src-tauri/src/core/email_generator.rs`:

```rust
// å°†åå­—æ•°æ®é›†ç¼–è¯‘è¿›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé¿å…è·¯å¾„é—®é¢˜
const NAMES_DATASET: &str = include_str!("../../names-dataset.txt");

impl EmailGenerator {
    pub fn new(domain: String) -> Result<Self, Box<dyn std::error::Error>> {
        // ä½¿ç”¨ç¼–è¯‘è¿›æ¥çš„åå­—æ•°æ®é›†
        let names: Vec<String> = NAMES_DATASET
            .lines()
            .map(|s| s.trim().to_string())
            .filter(|s| !s.is_empty())
            .collect();
        
        if names.is_empty() {
            return Err("åå­—æ•°æ®é›†ä¸ºç©º".into());
        }
        
        Ok(Self { names, domain })
    }
}
```

### ä¼˜ç‚¹

âœ… **æ— è·¯å¾„é—®é¢˜** - æ•°æ®ç›´æ¥ç¼–è¯‘è¿›äºŒè¿›åˆ¶
âœ… **å¯åŠ¨æ›´å¿«** - ä¸éœ€è¦è¯»å–æ–‡ä»¶
âœ… **æ›´å¯é ** - ä¸ä¾èµ–å¤–éƒ¨æ–‡ä»¶
âœ… **è·¨å¹³å°** - Windowsã€macOSã€Linux éƒ½é€‚ç”¨
âœ… **æ›´å®‰å…¨** - æ–‡ä»¶å†…å®¹æ— æ³•è¢«ç¯¡æ”¹

### ç¼ºç‚¹

âš ï¸ **äºŒè¿›åˆ¶æ–‡ä»¶å¢å¤§** - çº¦å¢åŠ  100KBï¼ˆnames-dataset.txt çš„å¤§å°ï¼‰
âš ï¸ **æ›´æ–°åå­—åº“éœ€è¦é‡æ–°ç¼–è¯‘** - ä¸èƒ½åŠ¨æ€æ›´æ¢

---

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶æ¸…å•

### å·²ä¿®æ”¹æ–‡ä»¶

1. **`src-tauri/tauri.conf.json`**
   - ä¿®æ”¹ `targets` ä¸º `["nsis"]`
   - ç§»é™¤ `resources` å­—æ®µï¼ˆä¸å†éœ€è¦ï¼‰

2. **`src-tauri/src/core/email_generator.rs`**
   - æ·»åŠ  `const NAMES_DATASET: &str = include_str!("../../names-dataset.txt");`
   - ä¿®æ”¹ `new()` å‡½æ•°ä½¿ç”¨ç¼–è¯‘è¿›æ¥çš„æ•°æ®
   - åˆ é™¤ `get_names_file_path()` å‡½æ•°ï¼ˆä¸å†éœ€è¦ï¼‰

---

## ğŸš€ é‡æ–°æ‰“åŒ…

ä¿®å¤åï¼Œé‡æ–°æ‰“åŒ…ï¼š

### Windows

```cmd
REM æ–¹å¼ 1: ä½¿ç”¨è„šæœ¬
build-windows.bat

REM æ–¹å¼ 2: æ‰‹åŠ¨å‘½ä»¤
npm run tauri:build
```

### è¾“å‡ºæ–‡ä»¶

```
src-tauri/target/release/bundle/nsis/
â””â”€â”€ Cursor reset tool_1.0.0_x64-setup.exe
```

---

## âœ… éªŒè¯ä¿®å¤

### 1. æ¸…ç†æ—§æ„å»º

```cmd
rmdir /s /q src-tauri\target\release
```

### 2. é‡æ–°æ„å»º

```cmd
npm run tauri:build
```

### 3. æµ‹è¯•é‚®ç®±ç”Ÿæˆ

1. è¿è¡Œç”Ÿæˆçš„å®‰è£…åŒ…
2. å®‰è£…åº”ç”¨
3. æ‰“å¼€åº”ç”¨
4. åˆ‡æ¢åˆ°"é‚®ç®±ç”Ÿæˆ"æ ‡ç­¾é¡µ
5. è¾“å…¥åŸŸåï¼Œç‚¹å‡»"ç”Ÿæˆè´¦å·"
6. åº”è¯¥æˆåŠŸç”Ÿæˆé‚®ç®±å’Œå¯†ç 

---

## ğŸ” å…¶ä»–å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼ˆæœªé‡‡ç”¨ï¼‰

### æ–¹æ¡ˆ 1: ä½¿ç”¨ Tauri resourcesï¼ˆå¤æ‚ï¼‰

```json
"bundle": {
    "resources": ["names-dataset.txt"]
}
```

**é—®é¢˜ï¼š**
- éœ€è¦ä½¿ç”¨ Tauri çš„ PathResolver API
- ä¸åŒå¹³å°è·¯å¾„ä¸åŒ
- ä»£ç æ›´å¤æ‚

### æ–¹æ¡ˆ 2: ä½¿ç”¨ç½‘ç»œèµ„æºï¼ˆä¸å¯é ï¼‰

ä»ç½‘ç»œä¸‹è½½åå­—æ•°æ®é›†

**é—®é¢˜ï¼š**
- éœ€è¦ç½‘ç»œè¿æ¥
- é¦–æ¬¡å¯åŠ¨æ…¢
- ä¸å¤Ÿå¯é 

### æ–¹æ¡ˆ 3: ç¡¬ç¼–ç åå­—åˆ—è¡¨ï¼ˆä¸çµæ´»ï¼‰

ç›´æ¥åœ¨ä»£ç ä¸­å®šä¹‰åå­—æ•°ç»„

**é—®é¢˜ï¼š**
- ä»£ç å†—é•¿
- éš¾ä»¥ç»´æŠ¤
- åå­—æ•°é‡æœ‰é™

---

## ğŸ“ ç¼–è¯‘æ—¶åŒ…å«æ–‡ä»¶çš„å…¶ä»–ç”¨é€”

`include_str!` å®è¿˜å¯ä»¥ç”¨äºï¼š

```rust
// åŒ…å« HTML æ¨¡æ¿
const TEMPLATE: &str = include_str!("template.html");

// åŒ…å« SQL è„šæœ¬
const SCHEMA: &str = include_str!("schema.sql");

// åŒ…å«é…ç½®æ–‡ä»¶
const CONFIG: &str = include_str!("default_config.json");

// åŒ…å«è®¸å¯è¯æ–‡æœ¬
const LICENSE: &str = include_str!("../LICENSE");
```

---

## ğŸ¯ æ€»ç»“

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | çŠ¶æ€ |
|------|---------|------|
| WiX ä¸‹è½½å¤±è´¥ | åªç”Ÿæˆ NSIS å®‰è£…åŒ… | âœ… å·²ä¿®å¤ |
| æ‰¾ä¸åˆ° names-dataset.txt | ä½¿ç”¨ `include_str!` ç¼–è¯‘è¿›äºŒè¿›åˆ¶ | âœ… å·²ä¿®å¤ |

**ä¿®å¤åçš„ä¼˜åŠ¿ï¼š**
- âœ… æ‰“åŒ…é€Ÿåº¦æ›´å¿«ï¼ˆä¸éœ€è¦ä¸‹è½½ WiXï¼‰
- âœ… è¿è¡Œæ›´å¯é ï¼ˆä¸ä¾èµ–å¤–éƒ¨æ–‡ä»¶ï¼‰
- âœ… å¯åŠ¨æ›´å¿«ï¼ˆæ•°æ®åœ¨å†…å­˜ä¸­ï¼‰
- âœ… è·¨å¹³å°å…¼å®¹æ€§æ›´å¥½

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ›´æ–°åå­—æ•°æ®é›†**
   - ä¿®æ”¹ `src-tauri/names-dataset.txt`
   - é‡æ–°ç¼–è¯‘å³å¯

2. **äºŒè¿›åˆ¶å¤§å°**
   - å¢åŠ çº¦ 100KBï¼ˆå¯æ¥å—ï¼‰
   - å¦‚éœ€ä¼˜åŒ–ï¼Œå¯ä»¥å‹ç¼©åå­—åˆ—è¡¨

3. **å†…å­˜ä½¿ç”¨**
   - åå­—åˆ—è¡¨åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åŠ è½½åˆ°å†…å­˜
   - çº¦å ç”¨ 200KB å†…å­˜ï¼ˆå¯æ¥å—ï¼‰

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®ï¼ˆå¯é€‰ï¼‰

1. **å‹ç¼©åå­—åˆ—è¡¨**
   ```rust
   use flate2::read::GzDecoder;
   const COMPRESSED_NAMES: &[u8] = include_bytes!("../../names-dataset.txt.gz");
   ```

2. **æ‡’åŠ è½½**
   ```rust
   use once_cell::sync::Lazy;
   static NAMES: Lazy<Vec<String>> = Lazy::new(|| {
       NAMES_DATASET.lines().map(String::from).collect()
   });
   ```

3. **ä½¿ç”¨æ›´å°çš„åå­—åº“**
   - å½“å‰ï¼š36,000+ ä¸ªåå­—
   - å¯ä»¥ç²¾ç®€åˆ° 1,000-5,000 ä¸ªå¸¸ç”¨åå­—

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Tauri Bundling](https://tauri.app/v1/guides/building/)
- [Rust include_str! macro](https://doc.rust-lang.org/std/macro.include_str.html)
- [NSIS Documentation](https://nsis.sourceforge.io/)

---

<div align="center">

**é—®é¢˜å·²å®Œå…¨è§£å†³ï¼å¯ä»¥æ­£å¸¸æ‰“åŒ…ä½¿ç”¨äº†ï¼** âœ…

</div>

